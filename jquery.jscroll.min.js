/*!
 * jScroll - jQuery Plugin for Infinite Scrolling / Auto-Paging
 * http://jscroll.com/
 *
 * Copyright 2011-2013, Philip Klauzinski
 * http://klauzinski.com/
 * Dual licensed under the MIT and GPL Version 2 licenses.
 * http://jscroll.com/#license
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
 *
 * @author Philip Klauzinski
 * @version 2.3.5
 * @requires jQuery v1.4.3+
 * @preserve
 */
!function(t){"use strict";t.jscroll={defaults:{debug:!1,autoTrigger:!0,autoTriggerUntil:!1,loadingHtml:"<small>Loading...</small>",loadingFunction:!1,padding:0,nextSelector:"a:last",contentSelector:"",pagingSelector:"",dataType:"html",dataURL:!1,dataProcess:!1,callback:!1}};var e=function(e,n){var o=e.data("jscroll"),r="function"==typeof n?{callback:n}:n,l=t.extend({},t.jscroll.defaults,r,o||{}),i="visible"===e.css("overflow-y"),a=e.find(l.nextSelector).first(),c=t(window),s=t("body"),d=i?c:e,f=t.trim(a.attr("href")+" "+l.contentSelector),u=function(){var e=t(l.loadingHtml).filter("img").attr("src");if(e){var n=new Image;n.src=e}},g=function(){e.find(".jscroll-inner").length||e.contents().wrapAll('<div class="jscroll-inner" />')},p=function(t){var e;l.pagingSelector?t.closest(l.pagingSelector).hide():(e=t.parent().not(".jscroll-inner,.jscroll-added").addClass("jscroll-next-parent").hide(),e.length||t.wrap('<div class="jscroll-next-parent" />').parent().hide())},h=function(){return d.unbind(".jscroll"),e.removeData("jscroll").find(".jscroll-inner").children().unwrap().filter(".jscroll-added").children().unwrap()},j=function(){if(e.is(":visible")){g();var t=e.find("div.jscroll-inner").first(),n=e.data("jscroll"),o=parseInt(e.css("borderTopWidth"),10),r=isNaN(o)?0:o,a=parseInt(e.css("paddingTop"),10)+r,c=i?d.scrollTop():e.offset().top,s=t.length?t.offset().top:0,f=Math.ceil(c-s+d.height()+a);if(!n.waiting&&f+l.padding>=t.outerHeight())return w("info","jScroll:",t.outerHeight()-f,"from bottom. Loading next request..."),b()}},v=function(t){return t=t||e.data("jscroll"),t&&t.nextHref?(y(),!0):(w("warn","jScroll: nextSelector not found - destroying"),h(),!1)},y=function(){var n=e.find(l.nextSelector).first();if(n.length)if(l.autoTrigger&&(l.autoTriggerUntil===!1||l.autoTriggerUntil>0)){p(n);var o=s.height()-e.offset().top,r=e.height()<o?e.height():o,i=e.offset().top-c.scrollTop()>0?c.height()-(e.offset().top-t(window).scrollTop()):c.height();i>=r&&j(),e.find(l.nextSelector).length&&d.unbind(".jscroll").bind("scroll.jscroll",function(){return j()}),l.autoTriggerUntil>0&&l.autoTriggerUntil--}else d.unbind(".jscroll"),n.bind("click.jscroll",function(){return p(n),b(),!1})},b=function(){var n=e.find("div.jscroll-inner").first(),o=e.data("jscroll");return o.waiting=!0,n.append('<div class="jscroll-added" />').children(".jscroll-added").last().html('<div class="jscroll-loading" id="jscroll-loading">'+l.loadingHtml+"</div>").promise().done(function(){l.loadingFunction&&l.loadingFunction()}),e.animate({scrollTop:n.outerHeight()},0,function(){var e=n.find("div.jscroll-added").last();if("html"===l.dataType)e.load(o.nextHref,function(t,e){return"error"===e?h():void m(this)});else if("json"===l.dataType){if(l.dataURL===!1)return w("warn","jScroll: no dataURL present for JSON data type - destroying"),h();t.getJSON(l.dataURL,function(t,n){return"error"!==n&&l.dataProcess?(l.dataProcess&&l.dataProcess.call(this,e,t),void m(e)):h()})}else{if(!l.dataProcess)return h();l.dataProcess.call(this,e),m(e)}})},m=function(n){var o=t(n).find(l.nextSelector).first();data.waiting=!1,data.nextHref=o.attr("href")?t.trim(o.attr("href")+" "+l.contentSelector):!1,t(".jscroll-next-parent",e).remove();var r=v();l.callback&&l.callback.call(n,r),w("dir",data)},w=function(t){if(l.debug&&"object"==typeof console&&("object"==typeof t||"function"==typeof console[t]))if("object"==typeof t){var e=[];for(var n in t)"function"==typeof console[n]?(e=t[n].length?t[n]:[t[n]],console[n].apply(console,e)):console.log.apply(console,e)}else console[t].apply(console,Array.prototype.slice.call(arguments,1))};return e.data("jscroll",t.extend({},o,{initialized:!0,waiting:!1,nextHref:f})),g(),u(),y(),t.extend(e.jscroll,{destroy:h}),e};t.fn.jscroll=function(n){return this.each(function(){var o,r=t(this),l=r.data("jscroll");l&&l.initialized||(o=new e(r,n))})}}(jQuery);